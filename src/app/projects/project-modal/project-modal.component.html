<div class="modal-overlay" [class.open]="isOpen" (click)="onBackdropClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="project">
    <!-- Header del modal -->
    <header class="modal-header">
      <h2 class="modal-title">{{ project.nombre }}</h2>
      <button class="close-button" (click)="onClose()" aria-label="Cerrar modal">
        ‚úï
      </button>
    </header>

    <!-- Contenido del modal -->
    <div class="modal-body">
      <!-- Descripci√≥n -->
      <div class="project-description">
        <p>{{ project.descripcion }}</p>
      </div>

      <!-- Galer√≠a de im√°genes y videos -->
      <div class="media-gallery">
        <div class="gallery-container">
          <!-- Im√°genes -->
          <div 
            *ngFor="let imagen of project.imagenes; let i = index"
            class="gallery-slide"
            [class.active]="i === currentMediaIndex && currentMediaType === 'image'">
            <img [src]="imagen" [alt]="project.nombre + ' - Captura ' + (i + 1)" />
          </div>
          
          <!-- Videos -->
          <div 
            *ngFor="let video of project.videos; let i = index"
            class="gallery-slide video-slide"
            [class.active]="i === currentMediaIndex && currentMediaType === 'video'">
            
            <!-- Reproductor de video embebido -->
            <div class="video-container">
              <iframe 
                [src]="getSafeVideoUrlByIndex(i)" 
                [title]="project.nombre + ' - Demo ' + (i + 1)"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" 
                allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"
                class="video-iframe">
              </iframe>
            </div>
          </div>
        </div>
        
        <!-- Controles de navegaci√≥n -->
        <div class="gallery-controls" *ngIf="getTotalMediaCount() > 1">
          <button 
            class="gallery-btn prev" 
            (click)="previousMedia()"
            aria-label="Medio anterior">
            ‚Äπ
          </button>
          <button 
            class="gallery-btn next" 
            (click)="nextMedia()"
            aria-label="Siguiente medio">
            ‚Ä∫
          </button>
        </div>

        <!-- Indicadores -->
        <div class="gallery-indicators" *ngIf="getTotalMediaCount() > 1">
          <!-- Indicadores para videos (PRIMERO) -->
          <button
            *ngFor="let video of project.videos; let i = index"
            class="indicator video-indicator"
            [class.active]="i === currentMediaIndex && currentMediaType === 'video'"
            (click)="goToMedia('video', i)"
            [attr.aria-label]="'Ir a video ' + (i + 1)">
            
          </button>
          
          <!-- Indicadores para im√°genes (DESPU√âS) -->
          <button
            *ngFor="let imagen of project.imagenes; let i = index"
            class="indicator image-indicator"
            [class.active]="i === currentMediaIndex && currentMediaType === 'image'"
            (click)="goToMedia('image', i)"
            [attr.aria-label]="'Ir a imagen ' + (i + 1)">
            
          </button>
        </div>
      </div>

      <!-- Tecnolog√≠as -->
      <div class="technologies-section">
        <h3>Tecnolog√≠as utilizadas</h3>
        <div class="technologies-grid">
          <span 
            *ngFor="let tech of project.tecnologias" 
            class="tech-badge">
            {{ tech }}
          </span>
        </div>
      </div>

      <!-- Flujo de App (solo para proyectos con hasFlowDetails) -->
      <div class="flow-section" *ngIf="project.hasFlowDetails">
        <h3>Flujo de App</h3>
        <div class="flow-content">
          
          <!-- Usuarios de Prueba -->
          <h2>üîê Usuarios de Prueba</h2>
          <div class="users-grid">
            <div class="user-card" *ngFor="let user of testUsers; let i = index">
              <h4>{{ user.emoji }} {{ user.title }}</h4>
              
              <div class="credential-row">
                <span class="credential-label"><strong>Email:</strong></span>
                <span class="credential-value">{{ user.email }}</span>
                <button 
                  class="copy-btn"
                  [class.copied]="isCopyFeedbackActive(i, 'email')"
                  (click)="copyToClipboard(user.email, i + '-email')"
                  title="Copiar email">
                  <img *ngIf="!isCopyFeedbackActive(i, 'email')" 
                       src="/assets/images/copyBlack.png" 
                       alt="Copiar" 
                       class="copy-icon">
                  <span *ngIf="isCopyFeedbackActive(i, 'email')">‚úÖ</span>
                </button>
              </div>
              
              <div class="credential-row">
                <span class="credential-label"><strong>Pass:</strong></span>
                <span class="credential-value">{{ user.password }}</span>
                <button 
                  class="copy-btn"
                  [class.copied]="isCopyFeedbackActive(i, 'password')"
                  (click)="copyToClipboard(user.password, i + '-password')"
                  title="Copiar contrase√±a">
                  <img *ngIf="!isCopyFeedbackActive(i, 'password')" 
                       src="/assets/images/copyBlack.png" 
                       alt="Copiar" 
                       class="copy-icon">
                  <span *ngIf="isCopyFeedbackActive(i, 'password')">‚úÖ</span>
                </button>
              </div>
            </div>
          </div>

          <hr>

          <!-- Roles y Funcionalidades -->
          <h2>üöÄ Roles y Funcionalidades</h2>
          <div class="roles-grid">
            <div class="role-section" *ngFor="let role of userRoles">
              <h3>{{ role.emoji }} {{ role.title }}</h3>
              <strong>{{ role.subtitle }}</strong>
              <ul>
                <li *ngFor="let feature of role.features">{{ feature }}</li>
              </ul>
              <strong *ngIf="role.extra">{{ role.extra }}</strong>
            </div>
          </div>

          <hr>

          <!-- Flujo de Reserva -->
          <div [innerHTML]="getFormattedFlowContent()"></div>
          
        </div>
      </div>

      <!-- Botones de acci√≥n -->
      <div class="action-buttons">
        <a 
          [href]="project.githubUrl" 
          target="_blank" 
          rel="noopener noreferrer"
          class="btn btn-outline">
          Ver en GitHub
        </a>
        <a 
          [href]="project.hostedUrl" 
          target="_blank" 
          rel="noopener noreferrer"
          class="btn btn-primary">
          Ver Proyecto
        </a>
      </div>
    </div>
  </div>
</div>
